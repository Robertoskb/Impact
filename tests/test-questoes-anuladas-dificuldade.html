<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Quest√µes Anuladas na An√°lise de Dificuldade</title>
</head>
<body>
    <h1>Teste: Quest√µes Anuladas na An√°lise de Dificuldade</h1>
    <div id="output"></div>
    
    <script>
        console.log("üß™ TESTE: Quest√µes Anuladas na An√°lise de Dificuldade");
        
        // Simular quest√µes com algumas anuladas
        const testQuestions = [
            // Quest√µes v√°lidas com dificuldade
            {
                position: 145,
                originalPosition: 136,
                area: "MT",
                cancelled: false,
                difficulty: 580, // F√°cil
                difficultyLevel: "F√°cil"
            },
            {
                position: 146,
                originalPosition: 137,
                area: "MT", 
                cancelled: false,
                difficulty: 720, // M√©dia
                difficultyLevel: "M√©dia"
            },
            // Quest√£o anulada (n√£o deve ter dados de dificuldade)
            {
                position: 147,
                originalPosition: null, // Sem mapeamento
                area: "MT",
                cancelled: true,
                difficulty: null, // DEVE SER NULL
                difficultyLevel: "Anulada" // DEVE SER "Anulada"
            },
            {
                position: 148,
                originalPosition: 139,
                area: "MT",
                cancelled: false,
                difficulty: 850, // Muito dif√≠cil
                difficultyLevel: "Muito dif√≠cil"
            },
            // Outra quest√£o anulada
            {
                position: 149,
                originalPosition: null, // Sem mapeamento
                area: "MT",
                cancelled: true,
                difficulty: null, // DEVE SER NULL
                difficultyLevel: "Anulada" // DEVE SER "Anulada"
            }
        ];
        
        function testDifficultyGrouping() {
            let output = document.getElementById('output');
            let html = '<h2>Teste de Agrupamento por Dificuldade:</h2>';
            
            // Agrupar por n√≠vel de dificuldade
            const groups = {};
            testQuestions.forEach((q) => {
                if (!groups[q.difficultyLevel]) {
                    groups[q.difficultyLevel] = { total: 0, questions: [] };
                }
                groups[q.difficultyLevel].total++;
                groups[q.difficultyLevel].questions.push(q);
            });
            
            html += '<h3>Grupos encontrados:</h3>';
            
            const difficultyOrder = ["F√°cil", "M√©dia", "Dif√≠cil", "Muito dif√≠cil", "Anulada"];
            
            difficultyOrder.forEach(level => {
                if (groups[level]) {
                    const group = groups[level];
                    html += `<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc;">`;
                    html += `<h4>${level} (${group.total} quest√µes)</h4>`;
                    
                    group.questions.forEach(q => {
                        const diffDisplay = q.cancelled ? "N/A (Anulada)" : (q.difficulty || "N/A");
                        html += `<p>  ‚Üí Quest√£o ${q.position}: Dificuldade = ${diffDisplay}</p>`;
                    });
                    
                    html += `</div>`;
                }
            });
            
            html += '<h3>‚úÖ Verifica√ß√µes:</h3>';
            html += '<ul>';
            
            // Verificar se quest√µes anuladas n√£o t√™m dados de dificuldade
            const cancelledQuestions = testQuestions.filter(q => q.cancelled);
            const cancelledWithDifficulty = cancelledQuestions.filter(q => q.difficulty !== null);
            
            if (cancelledWithDifficulty.length === 0) {
                html += '<li style="color: green;">‚úÖ CORRETO: Nenhuma quest√£o anulada tem dados de dificuldade</li>';
            } else {
                html += `<li style="color: red;">‚ùå ERRO: ${cancelledWithDifficulty.length} quest√µes anuladas t√™m dados de dificuldade indevidos</li>`;
            }
            
            // Verificar se quest√µes anuladas est√£o marcadas como "Anulada"
            const cancelledWithWrongLevel = cancelledQuestions.filter(q => q.difficultyLevel !== "Anulada");
            
            if (cancelledWithWrongLevel.length === 0) {
                html += '<li style="color: green;">‚úÖ CORRETO: Todas as quest√µes anuladas est√£o marcadas como "Anulada"</li>';
            } else {
                html += `<li style="color: red;">‚ùå ERRO: ${cancelledWithWrongLevel.length} quest√µes anuladas n√£o est√£o marcadas como "Anulada"</li>`;
            }
            
            // Verificar se quest√µes v√°lidas t√™m dados corretos
            const validQuestions = testQuestions.filter(q => !q.cancelled);
            const validWithoutDifficulty = validQuestions.filter(q => q.difficulty === null);
            
            if (validWithoutDifficulty.length === 0) {
                html += '<li style="color: green;">‚úÖ CORRETO: Todas as quest√µes v√°lidas t√™m dados de dificuldade</li>';
            } else {
                html += `<li style="color: red;">‚ùå ERRO: ${validWithoutDifficulty.length} quest√µes v√°lidas n√£o t√™m dados de dificuldade</li>`;
            }
            
            html += '</ul>';
            
            html += '<h3>üìä Estat√≠sticas esperadas:</h3>';
            html += '<ul>';
            html += '<li>F√°cil: 1 quest√£o</li>';
            html += '<li>M√©dia: 1 quest√£o</li>';
            html += '<li>Muito dif√≠cil: 1 quest√£o</li>';
            html += '<li>Anulada: 2 quest√µes (sempre contam como acerto se respondidas)</li>';
            html += '</ul>';
            
            output.innerHTML = html;
        }
        
        testDifficultyGrouping();
    </script>
</body>
</html>
