<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulados - ENEM</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Modular CSS files for simulado -->
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/config.css">
    <link rel="stylesheet" href="assets/css/simulado-screen.css">
    <link rel="stylesheet" href="assets/css/results.css">
    <link rel="stylesheet" href="assets/css/tabs.css">
    <link rel="stylesheet" href="assets/css/modals.css">
    <link rel="stylesheet" href="assets/css/skills.css">
    <link rel="stylesheet" href="assets/css/saved-simulados.css">
    <link rel="stylesheet" href="assets/css/tri-scores.css">
    <link rel="stylesheet" href="assets/css/sub-navigation.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- DEBUG: Botão para testar resultados - Controlado por variável -->
    <div id="debug-button" style="position: fixed; top: 10px; right: 10px; z-index: 9999; background: #28a745; color: white; padding: 15px; border: none; cursor: pointer; display: none; border-radius: 8px; font-weight: bold; box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);" onclick="debugShowResults()">
        🎯 TESTAR NOTAS TRI
    </div>
    
    <!-- Botão de menu para mobile -->
    <button id="menuToggleBtn" class="menu-toggle">
        <i class="fa fa-bars"></i>
    </button>
    <div class="layout">
        <!-- Menu lateral -->
        <aside id="sidebar" class="sidebar">
            <h2 class="menu-title">Menu</h2>
            <nav>
                <ul class="menu-list">
                    <li><a href="index.html" class="menu-link"><i class="fa fa-home"></i> Início</a></li>
                    <li><a href="simulado.html" class="menu-link active"><i class="fa fa-edit"></i> Simulados</a></li>
                    <li><a href="#" class="menu-link"><i class="fa fa-cog"></i> Configurações</a></li>
                    <li><a href="#" id="toggleTheme" class="menu-link"><i class="fa fa-adjust"></i> Tema Light/Dark</a></li>
                    <li><a href="#" class="menu-link"><i class="fa fa-question-circle"></i> Ajuda</a></li>
                    <li><a href="#" class="menu-link"><i class="fa fa-info-circle"></i> Sobre</a></li>
                </ul>
            </nav>
        </aside>
        <!-- Conteúdo principal -->
        <div class="content" id="content">
            <!-- Tela de configuração do simulado -->
            <div id="config-screen" class="config-screen">
                <div class="container">
                    <h1><i class="fa fa-edit"></i> Simulados ENEM</h1>
                    
                    <div class="config-card">
                        <h2>Configurar Simulado</h2>
                        
                        <div class="config-section">
                            <h3><i class="fa fa-calendar"></i> Selecionar Ano</h3>
                            <div id="year-selection" class="year-buttons">
                                <!-- Anos serão carregados dinamicamente -->
                            </div>
                        </div>

                        <div class="config-section">
                            <h3><i class="fa fa-layer-group"></i> Tipo de Prova</h3>
                            <div class="exam-type-buttons">
                                <button class="exam-type-btn" data-type="dia1">
                                    <i class="fa fa-book"></i>
                                    <span>1º Dia</span>
                                    <small>Linguagens e Códigos + Ciências Humanas</small>
                                </button>
                                <button class="exam-type-btn" data-type="dia2">
                                    <i class="fa fa-calculator"></i>
                                    <span>2º Dia</span>
                                    <small>Ciências da Natureza + Matemática</small>
                                </button>
                                <button class="exam-type-btn" data-type="LC0">
                                    <i class="fa fa-language"></i>
                                    <span>LC - Inglês</span>
                                    <small>Linguagens e Códigos (Inglês)</small>
                                </button>
                                <button class="exam-type-btn" data-type="LC1">
                                    <i class="fa fa-language"></i>
                                    <span>LC - Espanhol</span>
                                    <small>Linguagens e Códigos (Espanhol)</small>
                                </button>
                                <button class="exam-type-btn" data-type="CH">
                                    <i class="fa fa-users"></i>
                                    <span>Ciências Humanas</span>
                                    <small>História, Geografia, Filosofia, Sociologia</small>
                                </button>
                                <button class="exam-type-btn" data-type="CN">
                                    <i class="fa fa-flask"></i>
                                    <span>Ciências da Natureza</span>
                                    <small>Física, Química, Biologia</small>
                                </button>
                                <button class="exam-type-btn" data-type="MT">
                                    <i class="fa fa-calculator"></i>
                                    <span>Matemática</span>
                                    <small>Matemática e suas Tecnologias</small>
                                </button>
                            </div>
                        </div>

                        <div class="config-section">
                            <h3><i class="fa fa-palette"></i> Cor da Prova</h3>
                            <div class="color-selection">
                                <!-- Cores serão carregadas dinamicamente baseadas no ano selecionado -->
                            </div>
                        </div>

                        <!-- Seleção de idioma para 1º dia -->
                        <div id="language-section" class="config-section" style="display: none;">
                            <h3><i class="fa fa-language"></i> Idioma Estrangeiro</h3>
                            <div class="language-buttons">
                                <button class="language-btn" data-language="LC0">
                                    <i class="fa fa-flag-usa"></i>
                                    <span>Inglês</span>
                                    <small>Língua Inglesa e suas Tecnologias</small>
                                </button>
                                <button class="language-btn" data-language="LC1">
                                    <i class="fa fa-flag"></i>
                                    <span>Espanhol</span>
                                    <small>Língua Espanhola e suas Tecnologias</small>
                                </button>
                            </div>
                        </div>

                        <div class="config-actions">
                            <button id="start-simulado" class="start-btn" disabled>
                                <i class="fa fa-play"></i> Iniciar Simulado
                            </button>
                            <button id="view-saved-simulados" class="saved-btn">
                                <i class="fa fa-history"></i> Ver Simulados Salvos
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tela de simulados salvos -->
            <div id="saved-simulados-screen" class="saved-simulados-screen" style="display: none;">
                <div class="container">
                    <div class="saved-simulados-card">
                        <div class="saved-header">
                            <h2><i class="fa fa-history"></i> Simulados Salvos</h2>
                            <button id="back-to-config" class="back-btn">
                                <i class="fa fa-arrow-left"></i> Voltar
                            </button>
                        </div>
                        
                        <div class="saved-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="total-saved">0</span>
                                <span class="stat-label">Total Salvos</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="average-performance">0%</span>
                                <span class="stat-label">Média Geral</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="best-performance">0%</span>
                                <span class="stat-label">Melhor Resultado</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="recent-count">0</span>
                                <span class="stat-label">Últimos 7 dias</span>
                            </div>
                        </div>

                        <div class="saved-simulados-list">
                            <div id="saved-simulados-container">
                                <!-- Lista de simulados será carregada aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tela do simulado -->
            <div id="simulado-screen" class="simulado-screen" style="display: none;">
                <div class="simulado-header">
                    <div class="container">
                        <div class="simulado-info">
                            <h2 id="simulado-title">Simulado ENEM</h2>
                            <div class="simulado-meta">
                                <span id="simulado-year"></span>
                                <span id="simulado-type"></span>
                                <span id="simulado-color"></span>
                            </div>
                        </div>
                        <div class="simulado-actions">
                            <button id="finish-simulado" class="finish-btn">
                                <i class="fa fa-check"></i> Finalizar
                            </button>
                            <button id="back-config" class="back-btn">
                                <i class="fa fa-arrow-left"></i> Voltar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="container">
                    <div class="simulado-content">
                        <div id="questions-container" class="questions-container">
                            <!-- Questões serão carregadas aqui -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tela de resultados -->
            <div id="results-screen" class="results-screen" style="display: none;">
                <div class="container">
                    <div class="results-card">
                        <h2><i class="fa fa-chart-bar"></i> Resultado do Simulado</h2>
                        
                        <!-- Navegação por Abas -->
                        <div class="results-tabs">
                            <button class="tab-button active" data-tab="geral">
                                <i class="fa fa-chart-line"></i> Visão Geral
                            </button>
                            <button class="tab-button" data-tab="habilidades">
                                <i class="fa fa-chart-pie"></i> Habilidades
                            </button>
                            <button class="tab-button" data-tab="areas">
                                <i class="fa fa-layer-group"></i> Por Área
                            </button>
                            <button class="tab-button" data-tab="dificuldade">
                                <i class="fa fa-signal"></i> Dificuldade
                            </button>
                            <button class="tab-button" data-tab="padroes">
                                <i class="fa fa-pattern"></i> Padrões
                            </button>
                            <button class="tab-button" data-tab="gabarito">
                                <i class="fa fa-clipboard-list"></i> Gabarito
                            </button>
                        </div>

                        <!-- Conteúdo das Abas -->
                        <div class="tab-content">
                            <!-- Aba Geral -->
                            <div id="tab-geral" class="tab-panel active">
                                <div class="results-summary">
                                    <div class="result-item">
                                        <span class="result-label">Total de Questões:</span>
                                        <span id="total-questions" class="result-value">0</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">Acertos:</span>
                                        <span id="correct-answers" class="result-value">0</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">Erros:</span>
                                        <span id="wrong-answers" class="result-value">0</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">Questões Anuladas:</span>
                                        <span id="cancelled-questions" class="result-value">0</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">Aproveitamento:</span>
                                        <span id="performance" class="result-value">0%</span>
                                    </div>
                                </div>
                                
                                <div class="general-stats">
                                    <h3><i class="fa fa-chart-bar"></i> Estatísticas Gerais</h3>
                                    <div id="general-stats-content">
                                        <!-- Conteúdo será gerado dinamicamente -->
                                    </div>
                                </div>
                            </div>

                            <!-- Aba Habilidades -->
                            <div id="tab-habilidades" class="tab-panel">
                                <div class="skills-report">
                                    <h3><i class="fa fa-chart-pie"></i> Desempenho por Habilidade</h3>
                                    <div id="skills-container" class="skills-container">
                                        <!-- Conteúdo será gerado dinamicamente -->
                                    </div>
                                </div>
                            </div>

                            <!-- Aba Por Área -->
                            <div id="tab-areas" class="tab-panel">
                                <h3><i class="fa fa-layer-group"></i> Desempenho por Área</h3>
                                <div id="areas-container" class="areas-container">
                                    <!-- Conteúdo será gerado dinamicamente -->
                                </div>
                            </div>

                            <!-- Aba Dificuldade -->
                            <div id="tab-dificuldade" class="tab-panel">
                                <h3><i class="fa fa-signal"></i> Análise por Dificuldade</h3>
                                <div id="difficulty-container" class="difficulty-container">
                                    <!-- Conteúdo será gerado dinamicamente -->
                                </div>
                            </div>

                            <!-- Aba Padrões -->
                            <div id="tab-padroes" class="tab-panel">
                                <h3><i class="fa fa-pattern"></i> Padrões de Acerto</h3>
                                <div id="patterns-container" class="patterns-container">
                                    <!-- Conteúdo será gerado dinamicamente -->
                                </div>
                            </div>

                            <!-- Aba Gabarito -->
                            <div id="tab-gabarito" class="tab-panel">
                                <h3><i class="fa fa-clipboard-list"></i> Gabarito Detalhado</h3>
                                <div id="answer-sheet-container" class="answer-sheet-container">
                                    <!-- Conteúdo será gerado dinamicamente -->
                                </div>
                            </div>
                        </div>

                        <div class="results-actions">
                            <button id="new-simulado" class="new-simulado-btn">
                                <i class="fa fa-plus"></i> Novo Simulado
                            </button>
                            <button id="review-answers" class="review-btn">
                                <i class="fa fa-eye"></i> Revisar Respostas
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmação para finalizar simulado -->
    <div id="finish-modal" class="modal" role="dialog" aria-labelledby="finish-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="finish-modal-title"><i class="fa fa-check-circle"></i> Finalizar Simulado</h3>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja finalizar o simulado?</p>
                <p class="modal-warning">Após finalizar, você verá o resultado e não poderá mais alterar suas respostas.</p>
            </div>
            <div class="modal-actions">
                <button id="finish-cancel" class="modal-btn cancel-btn">
                    <i class="fa fa-times"></i> Cancelar
                </button>
                <button id="finish-confirm" class="modal-btn confirm-btn">
                    <i class="fa fa-check"></i> Finalizar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmação para voltar à configuração -->
    <div id="back-modal" class="modal" role="dialog" aria-labelledby="back-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="back-modal-title"><i class="fa fa-exclamation-triangle"></i> Voltar à Configuração</h3>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja voltar?</p>
                <p class="modal-warning">O progresso atual será perdido e você não poderá recuperar suas respostas.</p>
            </div>
            <div class="modal-actions">
                <button id="back-cancel" class="modal-btn cancel-btn">
                    <i class="fa fa-times"></i> Cancelar
                </button>
                <button id="back-confirm" class="modal-btn confirm-btn">
                    <i class="fa fa-arrow-left"></i> Voltar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmação para salvar simulado -->
    <div id="save-simulado-modal" class="modal" role="dialog" aria-labelledby="save-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="save-modal-title"><i class="fa fa-save"></i> Salvar Simulado</h3>
            </div>
            <div class="modal-body">
                <p>Deseja salvar este simulado para poder revisar os resultados mais tarde?</p>
                <p class="modal-info">Você poderá acessar todos os dados e análises novamente através de "Ver Simulados Salvos".</p>
            </div>
            <div class="modal-actions">
                <button id="save-cancel" class="modal-btn cancel-btn">
                    <i class="fa fa-times"></i> Não Salvar
                </button>
                <button id="save-confirm" class="modal-btn confirm-btn">
                    <i class="fa fa-save"></i> Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmação para excluir simulado -->
    <div id="delete-simulado-modal" class="modal" role="dialog" aria-labelledby="delete-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="delete-modal-title"><i class="fa fa-trash"></i> Excluir Simulado</h3>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir este simulado?</p>
                <p class="modal-warning">Esta ação não pode ser desfeita.</p>
            </div>
            <div class="modal-actions">
                <button id="delete-cancel" class="modal-btn cancel-btn">
                    <i class="fa fa-times"></i> Cancelar
                </button>
                <button id="delete-confirm" class="modal-btn confirm-btn">
                    <i class="fa fa-trash"></i> Excluir
                </button>
            </div>
        </div>
    </div>

    
    <script>
        // =====================================
        // CONFIGURAÇÃO DE DEBUG
        // =====================================
        const DEBUG_MODE = true; // Altere para true para ativar o modo debug
        
        // Mostrar/esconder botão de debug baseado na variável
        document.addEventListener('DOMContentLoaded', function() {
            const debugButton = document.getElementById('debug-button');
            if (debugButton) {
                debugButton.style.display = DEBUG_MODE ? 'block' : 'none';
            }
        });
        
        // DEBUG: Função para testar a exibição de resultados
        function debugShowResults() {
            if (!DEBUG_MODE) {
                console.warn('DEBUG: Modo debug está desativado. Altere DEBUG_MODE para true.');
                return;
            }
            
            console.log('DEBUG: Forçando exibição da tela de resultados...');
            
            // Esconder outras telas
            const screens = ['config-screen', 'simulado-screen', 'saved-simulados-screen'];
            screens.forEach(screenId => {
                const screen = document.getElementById(screenId);
                if (screen) {
                    screen.style.display = 'none';
                }
            });
            
            // Mostrar tela de resultados
            const resultsScreen = document.getElementById('results-screen');
            if (resultsScreen) {
                resultsScreen.style.display = 'block';
                
                // Adicionar dados de teste nas estatísticas básicas
                const elements = {
                    'total-questions': '45',
                    'correct-answers': '30',
                    'wrong-answers': '15',
                    'cancelled-questions': '0',
                    'performance': '67%'
                };
                
                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                    }
                });
                
                // Simular dados para os renderizadores
                if (window.simuladoApp) {
                    // Criar dados fictícios
                    const mockStats = {
                        totalQuestions: 45,
                        correctAnswers: 30,
                        wrongAnswers: 15,
                        cancelledQuestions: 0,
                        performance: 67,
                        areaStats: {
                            'LC': { correct: 8, total: 9 },
                            'CH': { correct: 7, total: 9 },
                            'CN': { correct: 8, total: 9 },
                            'MT': { correct: 7, total: 9 }
                        }
                    };
                    
                    // Simular configuração para teste
                    window.simuladoApp.currentConfig = {
                        year: 2023,
                        type: 'LC0',
                        color: 'azul',
                        language: 'LC0'
                    };
                    
                    // Simular questões para teste
                    window.simuladoApp.questions = Array.from({length: 45}, (_, i) => ({
                        position: i + 1,
                        originalPosition: i + 1,
                        area: 'LC0',
                        cancelled: i >= 43 // últimas 2 questões anuladas
                    }));
                    
                    // Simular respostas para teste (padrão aleatório mas consistente)
                    window.simuladoApp.answers = {};
                    for (let i = 1; i <= 45; i++) {
                        // 67% de acertos aproximadamente
                        window.simuladoApp.answers[i] = Math.random() > 0.33 ? 'A' : 'B';
                    }
                    
                    // Simular meta data básico
                    window.simuladoApp.meta = {
                        2023: {
                            LC0: {}
                        }
                    };
                    
                    // Preencher meta data para as questões
                    for (let i = 1; i <= 43; i++) { // questões válidas
                        window.simuladoApp.meta[2023].LC0[i] = {
                            answer: 'A',
                            difficulty: Math.random() * 2 - 1, // -1 a 1
                            discrimination: Math.random() * 2 + 0.5 // 0.5 a 2.5
                        };
                    }
                    
                    // Atualizar o controller com dados fictícios
                    if (window.simuladoApp.resultsTabsController) {
                        window.simuladoApp.resultsTabsController.updateResults(mockStats);
                    }
                    
                    // Testar cálculo de notas TRI se disponível
                    if (window.simuladoApp.scoreCalculator) {
                        console.log('DEBUG: Testando cálculo de notas TRI...');
                        window.simuladoApp.scoreCalculator.calculateAllScores()
                            .then(triResults => {
                                console.log('DEBUG: Resultados TRI:', triResults);
                                if (triResults.totalCalculated > 0) {
                                    window.simuladoApp.updateTRIScoresDisplay(triResults);
                                }
                            })
                            .catch(error => {
                                console.log('DEBUG: Erro no cálculo TRI (esperado se modelos não existirem):', error.message);
                            });
                    }
                }
                
            } else {
                console.log('DEBUG: results-screen não encontrado!');
            }
        }
        
        // =====================================
        // INSTRUÇÕES DE USO DO DEBUG
        // =====================================
        /*
        Para ativar o modo debug:
        1. Altere a variável DEBUG_MODE para true (linha ~16)
        2. Recarregue a página
        3. Um botão vermelho "DEBUG: Mostrar Resultados" aparecerá no canto superior direito
        4. Clique no botão para testar a tela de resultados com dados fictícios
        
        Para desativar o modo debug:
        1. Altere a variável DEBUG_MODE para false
        2. Recarregue a página
        3. O botão de debug ficará oculto
        */
    </script>
    
    <script type="module" src="assets/js/simulado-main.js"></script>
</body>
</html>
